<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">

<script>
    (function(){
        if('yayi'){
            if (prompt('请输入文章密码') !== 'yayi'){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">




  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="MFC,可视化," />





  <link rel="alternate" href="/atom.xml" title="日和" type="application/atom+xml" />






<meta name="description" content="这是第五章了…话说我第三章还没写完…不过既然今天讲了第五章，而且昨天又为了作业了解了一些对话框的知识，横竖就先写第五章吧。">
<meta name="keywords" content="MFC,可视化">
<meta property="og:type" content="article">
<meta property="og:title" content="对话框（5">
<meta property="og:url" content="http://yoursite.com/2018/05/26/MFC基础/MFC：对话框（5/index.html">
<meta property="og:site_name" content="日和">
<meta property="og:description" content="这是第五章了…话说我第三章还没写完…不过既然今天讲了第五章，而且昨天又为了作业了解了一些对话框的知识，横竖就先写第五章吧。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://img.blog.csdn.net/20170413132453140?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413154205407?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413160353708?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://img.blog.csdn.net/20170413161710517?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">
<meta property="og:image" content="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/17AC4E9000444251886E3CD82D2CFF71/760">
<meta property="og:image" content="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/F0A6AAF86CA44352B5FB04B7955A4899/1113">
<meta property="og:image" content="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/3C74599EBFAA46E2ABEBC28AA4BA190C/1112">
<meta property="og:image" content="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/65817F93926B4954A7DB6AFA37AB0CF9/1246">
<meta property="og:image" content="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/27BA0EFEA5344616AD677413B9D94267/1255">
<meta property="og:image" content="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/115484B839D04AAF87C64C23AC09028A/1646">
<meta property="og:image" content="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/5D3D6F9DBA8549E5A76AB2ED81F4028F/1645">
<meta property="og:updated_time" content="2018-07-20T17:30:21.138Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="对话框（5">
<meta name="twitter:description" content="这是第五章了…话说我第三章还没写完…不过既然今天讲了第五章，而且昨天又为了作业了解了一些对话框的知识，横竖就先写第五章吧。">
<meta name="twitter:image" content="http://img.blog.csdn.net/20170413132453140?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '61a4cd7c1bed364065c7fe56474ba5df',
      indexName: 'yayiblogsearch',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/05/26/MFC基础/MFC：对话框（5/"/>





  <title>对话框（5 | 日和</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8214766f6334490a524e10cda5fd72cf";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">日和</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">BE WITH ME</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
			
			<!--增加的代码 start-->

          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/26/MFC基础/MFC：对话框（5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="傻瓜日和">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日和">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">对话框（5</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-26T01:17:47+08:00">
                2018-05-26
              </time>
            

            

            
          </span>

          

          
            
          

<span>&nbsp; | &nbsp;
<span id="busuanzi_value_page_pv" ></span>次阅读
</span>    

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <hr>
<p>这是第五章了…话说我第三章还没写完…不过既然今天讲了第五章，而且昨天又为了作业了解了一些对话框的知识，横竖就先写第五章吧。</p>
<a id="more"></a>
<hr>
<h2 id="一、对话框的基本概念"><a href="#一、对话框的基本概念" class="headerlink" title="一、对话框的基本概念"></a>一、对话框的基本概念</h2><p>对话框是收集信息或提供反馈的窗口，通过控件与用户进行交互。而控件是执行用户动作的窗口，通常需要依附于其父窗口（对话框、边框窗口、视图、控件栏等）所有。但是对话框则可以脱离SDI或MDI单独组成应用程序，若要建立一个对话框应用程序，需要在创建MFC工程文件时勾选“基于对话框“即可。</p>
<p><img src="http://img.blog.csdn.net/20170413132453140?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>它建立了一个对话框应用程序。</p>
<p>如果希望谁能够使用自定义的对话框，需要为自定义对话框创建一个类，这个步骤可以使用类向导完成。建立以后，就可以创建这个自定义对话框类的对象了。</p>
<p><strong>以消息对话框为例：</strong></p>
<p>常用的一种对话框是消息对话框即MessageBox(L”information”,L”title”,MB_YESNO|MB_ICONQUESTION);</p>
<blockquote>
<p>第三个参数决定了产生的消息对话框的外观：MB_YESNO代表对话框有两个按钮，一个是是（YES）一个是否（NO）；MB_ICONQUESTION代表产生的对话框在information前面有一个问号的icon。<br>除了以上两种，还有许多类似的组合。例如：MB_YESCANCEL、MB_OKRETRY等等，icon也还有多种类型。</p>
</blockquote>
<p>对话框有一些返回值，例如IDOK、IDCANCEL、IDNO、IDYES、IDABORT（呐，无意中发现shift加空格可以切换全半角…）、IDIGNORE、IDRETRY等。这些返回值可以告知程序哪个键被按下。</p>
<p><strong>对话框的分类：1.模态对话框</strong></p>
<p>模态对话框是一种在对话框打开时不允许进行父界面操作的对话框，大多数对话框都是模态对话框。建立模态对话框只需要调用函数DoModal()即可。它会完成加载模板与显示对话框的工作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//创建一个自己的对话框对应类名字是CMyDialog</div><div class="line">CMyDialog dlg;</div><div class="line">dlg.DoMal();</div><div class="line">//只要程序执行到这里，一个自定义的对话框就会被弹出来</div></pre></td></tr></table></figure>
<p><strong>对话框的分类：2.非模态对话框</strong></p>
<p>非模态对话框允许用户在打开这个对话框时执行其他操作，有少数对话框需要设置成非模态的形式。非模态对话框的创建与显示工作需要自己完成：自己编写构造函数、使用Craete加载模板、使用ShowWindow显示对话框。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">CMyDialog*pDlg=new CMyDialog(this);</div><div class="line">pDlg-&gt;Craete(IDD_DIALOG1);//与CMyDialog类对应的对话框ID</div><div class="line">pDlg-&gt;ShowWindow(SW_SHOW);</div></pre></td></tr></table></figure>
<p>在对话框程序中，有时需要自己在OnInitDialog函数中添加额外的初始化代码来完成对函数的初始化。也可以写对某些控件产生消息的处理函数。</p>
<h2 id="二、一个简单的静态与编辑控件对话框"><a href="#二、一个简单的静态与编辑控件对话框" class="headerlink" title="二、一个简单的静态与编辑控件对话框"></a>二、一个简单的静态与编辑控件对话框</h2><p><strong>第一步：在资源视图中添加对话框并设计控件</strong></p>
<p>这里用到了三种控件：静态控件Static Text、编辑控件Edit Control、按钮Button。它们均可以在属性界面修改ID，其中Static Text与Button可以在属性界面的“外观”-&gt;“Caption”一栏中修改显示文本，还可以修改诸如文字显示格式、边框样式等多种属性，不一一叙述。而Edit Control则需要在构造函数中才能设定初值。这里在后面有详述。</p>
<p>将这三种控件添加到对话框并进行调整，得到一个设计好的对话框。控件从工具箱添加。</p>
<blockquote>
<p>可多选控件并由toolbar的左对齐等功能快速调整</p>
</blockquote>
<p>全部设计完之后，可通过toolbar中的“测试对话框”查看布局，但没有消息函数会被执行。确定无误后，可以双击对话框为其建一个新的类。</p>
<blockquote>
<p>如果选择了对话框应用程序，VS会自动为你建立第一个类</p>
</blockquote>
<p><strong>第二步：为控件添加相应的成员变量</strong></p>
<p>在”添加”-&gt;“变量”中选择”控件变量“，即可为对应的控件添加变量。</p>
<p><img src="http://img.blog.csdn.net/20170413154205407?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>如上图。</p>
<blockquote>
<p>控件变量有两种类别，一种是如图的Control，一种是Value。Control类别建立的是这种控件对应类型的一个对象，Value类别建立的是这种控件对应的值。不管选哪种类别，都可以根据自己的需要修改变量类型。但是，控件类型是VS自己判断出的，不允许用户自己修改。</p>
</blockquote>
<p><strong>第三步：完成必要的初始化</strong></p>
<p>在第一步中提到，Edit Control在属性视图中没有初始值的设定。对Edit Control初始值的设定需要在对话框的初始化函数OnInitDialog中完成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//设置Edit Control的初始值</div><div class="line">//在CMyDialog::OnInitDialog()中</div><div class="line">edits =L&quot;1001&quot;;//Value类型的控件变量</div><div class="line">UpdateData(false);</div></pre></td></tr></table></figure>
<blockquote>
<p>UpdateData相当于是控件实际Value与Value类别控件变量之间的一个双向开关。当以false调用UpdateData时，把控件变量的值赋给控件；以true调用UpdateData时，把控件的值赋给控件变量；当不调用Updatadata时，两者不进行值的传递。</p>
<p>则在这里以false调用UpdateData，将edits的值给控件。</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20170413160353708?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>如果不调用UpdateData，1001无法显示。</p>
<p><strong>第四步：为控件建立消息与对应处理函数</strong></p>
<p>在这里以Button “确定”为例：当点击“确定”时，弹出一个MessageBox，显示现在的Edit Control信息。</p>
<p>为控件添加消息处理函数的方法与以前一样。使用类向导，在“命令”中寻找IDOK（以“确定”按钮为例），在右边的消息中选择一个，添加消息处理函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在CMyDialog::OnBnClickedOk中</span></div><div class="line">CString str;</div><div class="line">UpdateData(<span class="literal">true</span>);</div><div class="line">str.Format(<span class="string">"this is the value: %s"</span>,edits);</div><div class="line">MessageBox(str);</div></pre></td></tr></table></figure>
<p>最终于运行结果：</p>
<p><img src="http://img.blog.csdn.net/20170413161710517?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQXVndXN0eV8=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="结果"></p>
<h2 id="三、通用对话框"><a href="#三、通用对话框" class="headerlink" title="三、通用对话框"></a>三、通用对话框</h2><p>通用对话框就是预定义的对话框，他们可以执行各种标准的操作。</p>
<hr>
<p>今天写作业时，需要在单文档应用程序里加自定义对话框。在视图类里有一个菜单消息处理函数，在里面要弹出对话框。这时，可以通过语句<code>if(dialog.DoModal()==IDOK)Invalidate(true);</code>来进行判断是否按下了OK键。而且在这里没有调用UpdateData函数，控件对应的Value值也发生了改变。？？？？？？？？？？？？？暂存疑。<br>还遇到了一个函数：<code>editctr.GetWindowTextW(editcontent);</code><br>这个函数具体的作用？以及不能在视图中使用？用了之后两种错误，无论直接视图<code>GetDlgItem(IDC_DIALOG1)-&gt;GetWindowTextW(str);</code>还是用<code>dialog.GetDlgItem(IDC_DIALOG1)-&gt;GetWindowTextW(str);</code>都不行！一个直接停止工作另一个像是assert，不懂。</p>
<hr>
<h3 id="1-CFontDialog-字体对话框"><a href="#1-CFontDialog-字体对话框" class="headerlink" title="1.CFontDialog 字体对话框"></a>1.CFontDialog 字体对话框</h3><p>CFontDialog的部分成员函数：</p>
<blockquote>
<p>GetCurrentFont(LPLOGFONT lplf)：获得字体样式<br>GetColor():获得字体颜色<br>IsBold()/IsItalic()/IsUnderline()：是否粗体、斜体、带下划线</p>
</blockquote>
<p>在上一章中我们提到了LOGFONT与COLORREF，在这里不再提。包括自定义字体参数与选择与颜色设置。</p>
<p>创建对话框的方式仍然可以直接使用模态对话框，有个例子5-2，不再赘述。</p>
<p><img src="" alt="CFontDialog"></p>
<h3 id="2-CColorDialog-颜色对话框"><a href="#2-CColorDialog-颜色对话框" class="headerlink" title="2.CColorDialog 颜色对话框"></a>2.CColorDialog 颜色对话框</h3><p>CColorDialog的部分成员函数：</p>
<blockquote>
<p>COLORREF GetColor()：获得颜色<br>COLORREF* GetSavedCustomColors()：获得第一个自定义颜色的指针。<br>SetCurrentColor(COLORREF clr)：设置颜色。不要调用。在消息处理函数中系统自动在用户变更选择。否则会出错弹出failure那种。</p>
</blockquote>
<p><img src="" alt="CColorDialog"></p>
<h3 id="3-CFileDialog-文件对话框"><a href="#3-CFileDialog-文件对话框" class="headerlink" title="3.CFileDialog 文件对话框"></a>3.CFileDialog 文件对话框</h3><p>一种构造方式：<code>CFileDialog dlg(true,NULL,NULL,OFN_READONLY,L&quot;C++ source|*.cpp&quot;);//文件后缀与显示方式</code></p>
<p>这里给出它的两种构造函数的参数形式：不存在默认</p>
<p><code>(BOOL bOpenFileDialog,LPCTSTR lpszDefExt=(LPCTSTR)0,LPCTSTR lpszFileName=(LPCTSTR)0,DWORD dwFlags=6UL,LPCTSTR lpszFilter=(LPCTSTR)0,CWnd*pParentWnd=(CWnd*)0,DWORD dwSize=0UL,BOOL bVistaStyle=1)</code></p>
<p>如果第一个参数是true，打开。如果是false，另存为。</p>
<p><code>(const CFileDialog &amp;)</code></p>
<p>部分成员函数：</p>
<blockquote>
<p>CString GetFileName()：获得文件名<br>CString GetPathName()：获得文件路径<br>CString GetFileExt()：获得文件扩展名</p>
</blockquote>
<h3 id="4-CPrintDialog-打印对话框"><a href="#4-CPrintDialog-打印对话框" class="headerlink" title="4.CPrintDialog 打印对话框"></a>4.CPrintDialog 打印对话框</h3><p>有三种构造函数，常用的写出一个：<code>(true)/(false)</code>，（注：这种构造函数有其他缺省参数）这个参数确定了两种不同的文本排列方式，指定打印对话框还是打印设置对话框显示：false: 显示打印对话框 true:显示打印设置对话框。不存在默认。</p>
<p>部分成员函数：</p>
<blockquote>
<p>BOOL GetDefaults()：获得默认打印机<br>int GetCopies()：获得打印份数<br>int GetFromPage()：获得打印起始页<br>int GetToPage()：获得终止页</p>
</blockquote>
<h3 id="5-CFindRepalceDialog-寻找与替换对话框"><a href="#5-CFindRepalceDialog-寻找与替换对话框" class="headerlink" title="5.CFindRepalceDialog 寻找与替换对话框"></a>5.CFindRepalceDialog 寻找与替换对话框</h3><p>声明并初始化显示一个查找与替换对话框：<strong>注意！这里不能使用非指针否则在函数退出时dialog也没有了。由于这是一个无模式对话框，使用new在堆上分配新空间，而不是在栈上。在Create之前使用m_fr进行初始化，它是FINDREPLACE结构类型 ，使用IsTerminating决定对话框是否被终止。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CFindeReplaceDialog*pDlg=new CFindReplaceDialog();</div><div class="line">pDlg-&gt;Craete(true,NULL);//查找。false是查找与替换</div></pre></td></tr></table></figure>
<p><strong>CFindReplaceDialog是非模态对话框，不用DoModal，否则弹出Debug Failed！</strong></p>
<blockquote>
<p>我都快忘了，CString不是String，想用字符串常量初始化，是要加上L的。</p>
</blockquote>
<p>部分成员函数：</p>
<blockquote>
<p>CString GetFindString()：获得查找的字符串<br>CString getReplaceString()：获得替换的字符串<br>BOOL MathCase()：是否精确匹配字符串</p>
</blockquote>
<p>为使父窗口被通知查找/替换请求，必须在框架窗口使用WindowsRegister-WindowMessage函数并使用ON_REGISTERED_MESSAGE消息映射宏处理登记消息。你可以从框架窗口的回调函数中调用CFindReplaceDialog类成员表中列出的任何成员函数。</p>
<p>非模态对话框的消息处理，<a href="https://msdn.microsoft.com/en-us/library/w3d334fy.aspx#Members" target="_blank" rel="external">更多</a>。</p>
<h2 id="四、控件"><a href="#四、控件" class="headerlink" title="四、控件"></a>四、控件</h2><p>将MFC提供的控件简单罗列如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">控件类</th>
<th style="text-align:center">控件</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CStatic</td>
<td style="text-align:center">静态控件</td>
<td style="text-align:center">表示其他控件的文本</td>
</tr>
<tr>
<td style="text-align:center">CButton</td>
<td style="text-align:center">按钮控件</td>
<td style="text-align:center">下压按钮、单按钮、复选框</td>
</tr>
<tr>
<td style="text-align:center">CEdit</td>
<td style="text-align:center">编辑框控件</td>
<td style="text-align:center">文本输入</td>
</tr>
<tr>
<td style="text-align:center">CListBox</td>
<td style="text-align:center">列表框控件</td>
<td style="text-align:center">字符串列表</td>
</tr>
<tr>
<td style="text-align:center">CCombBox</td>
<td style="text-align:center">组合框控件</td>
<td style="text-align:center">编辑框与列表框的结合</td>
</tr>
<tr>
<td style="text-align:center">CScrollBar</td>
<td style="text-align:center">滚动条控件</td>
<td style="text-align:center">对话框中的滚动条</td>
</tr>
<tr>
<td style="text-align:center">CAntimateCtrl</td>
<td style="text-align:center">动画控件</td>
<td style="text-align:center">显示AVI视频文件</td>
</tr>
<tr>
<td style="text-align:center">CHeaderCtrl</td>
<td style="text-align:center">标题控件</td>
<td style="text-align:center">显示在文本列上的按钮</td>
</tr>
<tr>
<td style="text-align:center">CImageList</td>
<td style="text-align:center">图像列表控件</td>
<td style="text-align:center">大小相同的图标或位图</td>
</tr>
<tr>
<td style="text-align:center">CListCtrl</td>
<td style="text-align:center">列表控件</td>
<td style="text-align:center">图标与文字组成的列表</td>
</tr>
<tr>
<td style="text-align:center">CProgressCtrl</td>
<td style="text-align:center">进展条控件</td>
<td style="text-align:center">任务完成进展</td>
</tr>
<tr>
<td style="text-align:center">CRichEditCtrl</td>
<td style="text-align:center">多格式编辑框</td>
<td style="text-align:center">多格式的文本输入</td>
</tr>
<tr>
<td style="text-align:center">CSliderCtrl</td>
<td style="text-align:center">滑动条控件</td>
<td style="text-align:center">包含滑动条与刻度标记</td>
</tr>
<tr>
<td style="text-align:center">CPinButtonCtrl</td>
<td style="text-align:center">旋转框控件</td>
<td style="text-align:center">通过双向箭头增减值</td>
</tr>
<tr>
<td style="text-align:center">CStatusBarCtrl</td>
<td style="text-align:center">状态栏控件</td>
<td style="text-align:center">状态信息显示栏</td>
</tr>
<tr>
<td style="text-align:center">CToolBarCtrl</td>
<td style="text-align:center">工具栏控件</td>
<td style="text-align:center">工具信息显示栏</td>
</tr>
<tr>
<td style="text-align:center">CTabCtrl</td>
<td style="text-align:center">标签控件</td>
<td style="text-align:center">显示多页信息或控件</td>
</tr>
<tr>
<td style="text-align:center">CTreeCtrl</td>
<td style="text-align:center">树状列表控件</td>
<td style="text-align:center">树状的层次列表结构</td>
</tr>
<tr>
<td style="text-align:center">CBitmapButton</td>
<td style="text-align:center">位图按钮控件</td>
<td style="text-align:center">位图标签的按钮</td>
</tr>
<tr>
<td style="text-align:center">CDragListBox</td>
<td style="text-align:center">拖放列表控件</td>
<td style="text-align:center">允许用户拖放的列表项</td>
</tr>
<tr>
<td style="text-align:center">CDateTimeCtrl</td>
<td style="text-align:center">日期时间控件</td>
<td style="text-align:center">显示日期与时间</td>
</tr>
<tr>
<td style="text-align:center">CMonthCalCtrl</td>
<td style="text-align:center">月历控件</td>
<td style="text-align:center">显示月历</td>
</tr>
<tr>
<td style="text-align:center">CIPAddressCtrl</td>
<td style="text-align:center">IP地址控件</td>
<td style="text-align:center">显示IP地址</td>
</tr>
</tbody>
</table>
<h3 id="1-静态控件"><a href="#1-静态控件" class="headerlink" title="1.静态控件"></a>1.静态控件</h3><p>静态控件(CStatic)用于显示文本、图标、位图等，通常不用于输入与输出。控制静态控件的类是CStatic。它可以完成诸如改变静态控件的内容的工作。</p>
<p>想要为静态控件添加变量的话，一定要先修改他们的ID。然后对应空间才会出现在类向导的成员变量的控件名称里面。</p>
<p><img src="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/17AC4E9000444251886E3CD82D2CFF71/760" alt=""></p>
<p>为静态控件修改文本有两种方法：</p>
<p>1.在程序中不用修改：可直接在属性-&gt;外观-&gt;Caption进行修改。</p>
<ol>
<li>在程序中修改：<code>mctrl.SetWindowText(L&quot;ID&quot;);</code></li>
</ol>
<h3 id="2-按钮控件"><a href="#2-按钮控件" class="headerlink" title="2.按钮控件"></a>2.按钮控件</h3><p>按钮控件(CButton)是一种子窗口，通过单击它来执行某种操作。按钮控件又可以分为<strong>复选框、单选框、下压按钮</strong>。</p>
<p>CButton类的成员函数如下：</p>
<blockquote>
<p>GetIcon()/SetIcon()<br>GetCheck()/SetCheck()<br>GetButtonStyle()/SetButtonStyle()</p>
</blockquote>
<p>对按钮控件的修饰操作：</p>
<h4 id="1-修改位图按钮-文字按扭"><a href="#1-修改位图按钮-文字按扭" class="headerlink" title="1.修改位图按钮/文字按扭"></a>1.修改位图按钮/文字按扭</h4><p>修改属性-&gt;外观-&gt;Icon。如果这一项是false，按钮上面一定会有文字，即使加了位图也会并存。如果修改为true，纯位图按钮。类似于CStatic，在Caption改文字内容。</p>
<p>载入位图：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在CTestDialog::OnInitDialog中</span></div><div class="line">HICON icon;</div><div class="line">icon=AfxGetApp()-&gt;LoadIcon(IDR_MAINFRAME);</div><div class="line">mbtn.SetIcon(icon);</div></pre></td></tr></table></figure></p>
<h4 id="2-为按钮控件添加成员变量"><a href="#2-为按钮控件添加成员变量" class="headerlink" title="2.为按钮控件添加成员变量"></a>2.为按钮控件添加成员变量</h4><p>不用非要改名字，就可以添加。</p>
<h4 id="3-增加一个复选框控件"><a href="#3-增加一个复选框控件" class="headerlink" title="3.增加一个复选框控件"></a>3.增加一个复选框控件</h4><p>IDC_CHECK属于按钮控件。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CButton*pCheck=(CButton*)GetDlgItem(IDC_CHECK);</div><div class="line">CSTring str;</div><div class="line">str.Format(<span class="string">L"复选框状态:%d"</span>,pCheck-&gt;GetCheck());</div><div class="line">MessageBox(str);</div></pre></td></tr></table></figure></p>
<h3 id="3-组合框控件"><a href="#3-组合框控件" class="headerlink" title="3.组合框控件"></a>3.组合框控件</h3><p><strong>列表框控件(CListBox)：</strong> 用于显示列表项，查看与选择列表。<br><img src="" alt=""></p>
<p><strong>编辑框控件(CEdit)：</strong> 用于输入文本信息。<br><img src="" alt=""></p>
<p><strong>组合框控件(CComboBox)：</strong> 由列表框和编辑框组成。<br><img src="" alt=""></p>
<p>一些CComboBox的成员函数：</p>
<blockquote>
<p>GetCurSel：获得列表框当前项位置<br>GetLBText：获得列表框指定项内容<br>SetCurSel：设置列表框指定项位置<br>int AddString(LPCTSTR lpszItem)：列表框结尾添加字符串<br>InsertString：列表框插入字符串<br>DeleteString:列表框删除字符串<br>ResetContent：删除列表框中的所有项 </p>
</blockquote>
<p>组合框像是列表框与编辑框的组合。 它既可以像编辑框一样直接编辑，又可以下拉选择。</p>
<p>对组合框控件，在<strong>属性-&gt;行为-&gt;Data</strong>中可以设置下拉列表的每一项，每项之间应该用分号分开；在<strong>属性-&gt;外观-&gt;Type</strong>中有三个选项：Simple-简单的编辑框、DropDown-组合框功能、DropList-列表框功能。</p>
<p>对列表框控件，属性中没有提供添加选项的功能，只能在代码中通过自己写<code>int AddString(LPCTSTR lpszItem);</code>来添加。</p>
<p><strong>一个小例子</strong>：哦你们的markdown有bug。不能把冒号放后面</p>
<p><strong>组控件(Group Box)</strong>：组控件属于静态控件。它可以在Rect区域显示文本。</p>
<p><strong>静态文本(Static Text)</strong>：属于静态控件。</p>
<p>希望实现这样的功能：当用户在组合框里输入文本或者选择选项之后，在Rect区域显示该选项的预览。</p>
<hr>
<ol>
<li>在资源视图中添加Static Text、Combo Box、Group Box，为他们更改标识，为Combo Box添加初始列；</li>
<li>为Combo Box添加Value与Control类别的变量分别：m_number,m_ctrlNumber，为Group Box添加Control类别的变量m_ctrlDisplay；</li>
<li>在CTestDialog的.h文件中：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>:</div><div class="line">    CRect rect;<span class="comment">//为了表示Group Box的显示区域</span></div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的.cpp文件的OnInitDialog()中:OnInitDialog()是虚函数</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">m_ctrlDisplay.GetWindowRect(&amp;rect);<span class="comment">//那块显示区域在电脑屏幕上的坐标</span></div><div class="line">ScreenToClient(&amp;rect);<span class="comment">//把电脑屏幕的坐标转化为客户区的坐标</span></div><div class="line">m_ctrlNumber.SetCurSel(<span class="number">0</span>);<span class="comment">//设置0位的串为默认串</span></div><div class="line">m_ctrlNumber.GetLBText(<span class="number">0</span>,m_number);<span class="comment">//获取0位的串</span></div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的.cpp文件的OnPaint()的else中：OnPaint是消息-&gt;WM_PAINT-&gt;添加函数</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function">CPaintDC <span class="title">dc</span><span class="params">(<span class="keyword">this</span>)</span></span>;</div><div class="line">dc.SetBkMode(TRANSPARENT);<span class="comment">//字体的背景模式透明</span></div><div class="line">dc.SetTextColor(RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>));</div><div class="line">dc.TextOutW(rect.left+<span class="number">20</span>,rect.top+<span class="number">20</span>,m_number);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的.cpp文件的OnSelchangeNumber()中：是命令IDC_NUMBER-&gt;CBN_SELCHANGE函数</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//改变选择时更新Rect</span></div><div class="line">m_ctrlNumber.GetLBText(m_ctrlNumber.GetCurSel(),m_number);<span class="comment">//获取现在显示的那个串</span></div><div class="line">InvalidateRect(&amp;rect);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的.cpp文件的OnEditchangeNumber()中：是命令IDC_NUMBER-&gt;CBN_EDITCHANGE函数</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在输入字符串时更新Rect</span></div><div class="line">m_ctrlNumber.GetWindowText(m_number);<span class="comment">//获取写在上面的字符串</span></div><div class="line">InvalidateRect(&amp;rect);<span class="comment">//更新m_number中的内容</span></div></pre></td></tr></table></figure>
<hr>
<p><strong>Q</strong>：为什么Invalidate知道更新什么 废话</p>
<p><strong>刚开始一直error。后来发现是一个已经删掉的控件没有删ID，导致一直藏在代码中。</strong><br><img src="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/F0A6AAF86CA44352B5FB04B7955A4899/1113" alt=""></p>
<blockquote>
<p>标准模版库STL：是一种基于模板的容器类库，包括常用的数据结构与常用的算法。</p>
</blockquote>
<h3 id="4-列表框控件"><a href="#4-列表框控件" class="headerlink" title="4.列表框控件"></a>4.列表框控件</h3><p>定义类模板：<code>CtypedPtrList &lt;CObList,CStudent*&gt; m_pDataList</code></p>
<p><img src="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/3C74599EBFAA46E2ABEBC28AA4BA190C/1112" alt=""></p>
<p>m_pDataList的成员函数：</p>
<blockquote>
<p>GetHeadPosition 与 GetTailPosition</p>
<p>GetAt and GetPrev and GetNext</p>
<p>AddTail and RemoveHead</p>
<p>InsertAfter and InsertBefore</p>
<p>RemoveAt and RemoveAll</p>
<p>IsEmpty</p>
</blockquote>
<hr>
<p><strong>一个小例子</strong>：希望实现在一个列表框中，各条信息的添加、删除</p>
<p>1.在资源视图中添加对话框，并在对话框上添加下列控件：(Edit Box,IDC_ID),(Edit Box,IDC_NAME),(List Box,IDC_LIST),(Button,IDC_PREVIOUS),(Button,IDC_NEXT),(Button,IDC_ADD),(Button,IDC_CLOSE)</p>
<p>2.为控件IDC_ID添加Value类别空间变量m_id，IDC_NAME添加Value类别的m_name，IDC_LIST添加control的m_ctrlList。</p>
<p>3.在类向导中，点’添加类’按钮添加CStudent类，其基类是CObject</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span>:</div><div class="line">    CString m_id;</div><div class="line">    CString m_name;</div><div class="line">    CStudent(CString id,CString name)&#123;</div><div class="line">        m_id=id;</div><div class="line">        m_name=name;</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<p>4.在CTestDialog的.h文件中：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>:</div><div class="line">    POSITION m_pos;</div><div class="line">    CTypedPtrList&lt;CObList,CStudent*&gt; m_pDataList;<span class="comment">//链表</span></div></pre></td></tr></table></figure>
<p>5.在CTestDialog的OnAdd()中：是命令-&gt;IDC_ADD-&gt;BN_CLICKED</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">UpdateData(<span class="literal">true</span>);</div><div class="line"><span class="keyword">if</span>(m_id.GetLength()==<span class="number">0</span>)&#123;</div><div class="line">    MessageBox(<span class="string">L"ID cannot empty!"</span>);</div><div class="line">    (CEdit*)GetDlgItem(IDC_ID)-&gt;SetFocus();  </div><div class="line">    <span class="keyword">return</span>; </div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span>(m_name.GetLength()==<span class="number">0</span>)&#123;</div><div class="line">    MessageBox(<span class="string">L"Name cannot empty!"</span>);</div><div class="line">    (CEdit*)GetDlgItem(IDC_NAME)-&gt;SetFocus();  </div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">CStudent *pStudent;  <span class="comment">//向链表追加结点</span></div><div class="line">pStudent=<span class="keyword">new</span> CStudent(m_id,m_name);</div><div class="line">m_pDataList.AddTail(pStudent);</div><div class="line">m_pos=m_pDataList.GetTailPosition();</div><div class="line">CString str;  <span class="comment">//向ListBox追加字符串</span></div><div class="line">str = m_id+<span class="string">"  "</span>+m_name;  </div><div class="line">m_ctrlList.AddString(str);</div><div class="line">m_ctrlList.SetCurSel(m_ctrlList.GetCount()<span class="number">-1</span>);</div></pre></td></tr></table></figure>
<p>6.在CTestDialog的OnPrevious中：是命令-&gt;IDC_PREVIOUS-&gt;BN_CLICKED</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(m_pos!=<span class="literal">NULL</span>)&#123;</div><div class="line">    <span class="comment">//计算上一条记录在链表中位置</span></div><div class="line">    <span class="keyword">if</span>(m_pos==m_pDataList.GetHeadPosition())m_pos=m_pDataList.GetTailPosition();</div><div class="line">    <span class="keyword">else</span> m_pDataList.GetPrev(m_pos);</div><div class="line">    <span class="comment">//从链表中取出上一条记录</span></div><div class="line">    CStudent *pStudent=m_pDataList.GetAt(m_pos);</div><div class="line">    m_id=pStudent-&gt;m_id;  </div><div class="line">    m_name=pStudent-&gt;m_name;</div><div class="line">    UpdateData(<span class="literal">false</span>);</div><div class="line">    <span class="comment">//计算上一条记录在ListBox中位置并选中</span></div><div class="line">    <span class="keyword">int</span> pos=m_ctrlList.GetCurSel();</div><div class="line">    <span class="keyword">if</span>(pos==<span class="number">0</span>)  pos=m_ctrlList.GetCount()<span class="number">-1</span>;</div><div class="line">    <span class="keyword">else</span>  pos--;</div><div class="line">    m_ctrlList.SetCurSel(pos); </div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span>  MessageBox(<span class="string">L"No Item!"</span>);</div></pre></td></tr></table></figure>
<p>7.在CTestDialog的OnNext中：是命令-&gt;IDC_NEXT-&gt;BN_CLICKED</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(m_pos!=<span class="literal">NULL</span>)&#123;</div><div class="line">    <span class="comment">//计算下一条记录在链表中位置</span></div><div class="line">    <span class="keyword">if</span>(m_pos==m_pDataList.GetTailPosition())m_pos=m_pDataList.GetHeadPosition();</div><div class="line">    <span class="keyword">else</span> m_pDataList.GetNext(m_pos);</div><div class="line">    <span class="comment">//从链表中取出下一条记录</span></div><div class="line">    CStudent *pStudent=m_pDataList.GetAt(m_pos);</div><div class="line">    m_id=pStudent-&gt;m_id; </div><div class="line">    m_name=pStudent-&gt;m_name;</div><div class="line">    UpdateData(<span class="literal">false</span>);</div><div class="line">    <span class="comment">//计算下一条记录在ListBox中位置并选中</span></div><div class="line">    <span class="keyword">int</span> pos=m_ctrlList.GetCurSel();</div><div class="line">    <span class="keyword">if</span>(pos==m_ctrlList.GetCount()<span class="number">-1</span>)  pos=<span class="number">0</span>;</div><div class="line">    <span class="keyword">else</span>  pos++;</div><div class="line">    m_ctrlList.SetCurSel(pos); </div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span>  MessageBox(<span class="string">L"No Item!"</span>);</div></pre></td></tr></table></figure>
<p>8.在CTestDialog的OnClose中：是命令-&gt;IDC_CLOSE-&gt;BN_CLICKED</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(MessageBox(<span class="string">L"CloseDialog?"</span>,<span class="string">L"Close"</span>,MB_OKCANCEL|MB_ICONQUESTION)==IDOK)</div><div class="line">    CDialog::OnCancel();</div></pre></td></tr></table></figure>
<p>9.在CTestDialog的OnDestory中：是消息-&gt;WM_DESTORY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if(!m_pDataList.IsEmpty())</div><div class="line">    delete m_pDataList.RemoveHead();</div></pre></td></tr></table></figure>
<p>10.在CTestDialog的OnInitDialog中：是类向导-&gt;虚函数-&gt;OnInitDialog</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_pos=NULL;</div></pre></td></tr></table></figure>
<p>最终我们得到的效果如图：（这个排序似乎不是很对啊… :-$</p>
<p><img src="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/65817F93926B4954A7DB6AFA37AB0CF9/1246" alt=""></p>
<p>对上面的例子考虑做一下补充：</p>
<p>以状态图来控制按钮状态：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> STATE&#123;</div><div class="line">    STARTSTATE,</div><div class="line">    BROWSESTATE,</div><div class="line">    ADDSTATE,</div><div class="line">    MODIFYSTATE,</div><div class="line">    FINALSTATE,</div><div class="line">&#125;；</div></pre></td></tr></table></figure></p>
<p>设置SwitchState函数，并在函数中以<code>&lt;Control&gt;*p×=&lt;Control*&gt;GetDlgItem(ID)</code>来获取对象指针，并用p×-&gt;EnableWindow(false/true)来设置按钮是否可用。</p>
<p>最终可以：<br><img src="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/27BA0EFEA5344616AD677413B9D94267/1255" alt=""></p>
<hr>
<h3 id="番外：绘图程序的例子"><a href="#番外：绘图程序的例子" class="headerlink" title="番外：绘图程序的例子"></a>番外：绘图程序的例子</h3><blockquote>
<p>要求：带对话框的单文档应用程序：</p>
<p>1.add 画笔对话框，改变画笔样式与宽度</p>
<p>2.add 颜色对话框，改变画笔颜色</p>
<p>3.add 增加菜单栏与工具栏按钮，打开两种对话框</p>
<p>4.用画笔在视图窗口画一个矩形</p>
</blockquote>
<p>1.在资源视图中添加两个菜单项：ID_VIEW_PEN，ID_VIEW_COLOR；添加两个工具栏按钮ID同上，在快捷键列表添加快捷键：Ctrl+E与Ctrl+L。（快捷键列表：资源视图-&gt;Accelerator-&gt;IDR_AMINFRAME）</p>
<p>2.在资源视图中添加画笔的对话框，并添加控件：（颜色对话框使用内置对话框<br>|控件|标识|说明|<br>|:-:|:-:|:-:|<br>|Static Text|IDC_STATIC|Width|<br>|Edit Box|IDC_WIDTH||<br>|Group Box|IDC_STATIC|Style display|<br>|Radio Button|IDC_SOLID|Solid|<br>|Radio Button|IDC_DASH|dash|<br>|Radio Button|IDC_DOT|dot|<br>|Group Box|IDC_DISPLAY|display|</p>
<p>3.为控件添加成员变量：(IDC_WIDTH,Val,m_width),(IDC_SOLID,Val,m_style),(IDC_DISPLAY,Ctrl,m_ctrlDisplay)；添加普通变量CRect rect</p>
<p>4.在CPenDialog的定义前：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span>&#123;PEN_STYLE_SOLID,PEN_STYLE_DASH,PEN_STYLE_DOT&#125;</div></pre></td></tr></table></figure></p>
<p>5.在CPenDialog的OnInitDialog中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m_ctrlDisplay.GetWindowRect(&amp;rect);</div><div class="line">ScreenToClient(&amp;rect);</div></pre></td></tr></table></figure></p>
<p>6.在CPenDialog的OnChangeWidth中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UpdateData(<span class="literal">true</span>);</div><div class="line"><span class="keyword">if</span>(m_width&gt;<span class="number">1</span>&amp;&amp;m_width&lt;<span class="number">7</span>)InvalidateRect(&amp;rect);</div></pre></td></tr></table></figure></p>
<p>7.在CPenDialog的OnSolid/OnDash/OnDot中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m_style=PEN_STYLE_SOLID;(DASH/DOT)</div><div class="line">InvalidateRcet(&amp;rect);</div></pre></td></tr></table></figure></p>
<p>8.在CPenDialog的OnPaint中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">CPen newPen;</div><div class="line"><span class="keyword">switch</span>(m_style)&#123;</div><div class="line">    <span class="keyword">case</span> PEN_STYLE_SOLID:</div><div class="line">        newPen.CreatePen(PS_SOLID,m_width,RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));     </div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PEN_STYLE_DASH:</div><div class="line">        newPen.CreatePen(PS_DASH,m_width,RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));   </div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PEN_STYLE_DOT:</div><div class="line">        newPen.CreatePen(PS_DOT,m_width,RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        newPen.CraetePen(PS_SOLID,m_width,RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">dc.SelectObject(newPen);</div><div class="line">dc.MoveTo(rect.left+<span class="number">10</span>,rect.top+<span class="number">10</span>);</div><div class="line">dc.LineTo(rect.right<span class="number">-10</span>,rect.top+<span class="number">40</span>);</div></pre></td></tr></table></figure></p>
<p><strong>CTestView</strong></p>
<p>9.在CTestView的.h中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_width;</div><div class="line">    <span class="keyword">int</span> m_style;</div><div class="line">    COLORREF m_color;</div></pre></td></tr></table></figure></p>
<p>10.在CTestView构造函数中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">m_width=<span class="number">1</span>;</div><div class="line">m_style=PEN_STYLE_SOLID;</div><div class="line">m_color=RGB(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div></pre></td></tr></table></figure></p>
<p>11.在CTestView的OnViewPen中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CPenDialog penDlg;</div><div class="line">penDlg.m_width=m_width;</div><div class="line">penDlg.m_style=m_style;</div><div class="line"><span class="keyword">if</span>(penDlg.DoModal()==IDOK)&#123;</div><div class="line">    m_width=penDlg.m_width;</div><div class="line">    m_style=penDlg.m_style;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>12.在CTestView的OnViewColor中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CColorDialog colorDlg;</div><div class="line"><span class="keyword">if</span>(colorDlg.DoModal()==IDOK)m_color=colorDlg.GetColor();</div></pre></td></tr></table></figure></p>
<p>13.在CTestView的OnLButtonDown中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Pen newPen;</div><div class="line"><span class="keyword">switch</span>(m_style)&#123;</div><div class="line">    <span class="keyword">case</span> PEN_STYLE_SOLID:</div><div class="line">        newPen.CraetePen(PS_SOLID,m_width,M_color);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PEN_STYLE_DASH:</div><div class="line">        newPen.CreatePen(PS_DASH,m_width,m_color);</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    <span class="keyword">case</span> PEN_STYLE_DOT:</div><div class="line">        newPen.CraetePen(PS_DOT,m_width,m_color);</div><div class="line">        braek;</div><div class="line">  &#125;</div><div class="line">CDC*pDC=GetDC();</div><div class="line">pDC-&gt;SelectObject(newPen);</div><div class="line">pDC-&gt;Rectangle(<span class="number">20</span>,<span class="number">20</span>,<span class="number">200</span>,<span class="number">200</span>);</div></pre></td></tr></table></figure></p>
<p>注：当画笔宽度大时，DOT与DASH都会像是SOLID风格。</p>
<h3 id="5-旋转框控件-Spin"><a href="#5-旋转框控件-Spin" class="headerlink" title="5.旋转框控件(Spin)"></a>5.旋转框控件(Spin)</h3><p>旋转框控件与编辑框控件一起使用，通常用于双向计数器。</p>
<ol>
<li>添加编辑框控件与旋转框控件，使编辑框控件的Tab次序位于旋转框控件之前；</li>
<li>Alignment属性设置为Right；（外观-&gt;Alignment）</li>
<li>选中Auto Buddy与Set Buddy Integer；（行为-&gt;Auto Buddy/Set Buddy Integer）</li>
</ol>
<blockquote>
<p>上述的意义：</p>
<p>Alignment：Unattached-取消附加；Left-左对齐；Right Align-右对齐</p>
<p>Auto Buddy：自动按照Z顺序选择上一个控件作为数值调节按钮控件的合作窗口。</p>
<p>Set Buddy Integer：指定数值调节钮控件在它的位置改变时设置合作者窗口的文本。</p>
</blockquote>
<p>对于Alignment：</p>
<p>Left:<br><img src="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/115484B839D04AAF87C64C23AC09028A/1646" alt=""></p>
<p>Unattached:<br><img src="http://note.youdao.com/yws/public/resource/c075574f612d384feddbf490b48bfefc/xmlnote/5D3D6F9DBA8549E5A76AB2ED81F4028F/1645" alt=""></p>
<p><strong>!!!!!!记得在View.h里面加<code>#include&quot;CTestDialog.h&quot;</code>!!!!</strong></p>
<p>Spin控件Ctrl类型是CSpinButtonCtrl，添加ctrl的Spin控件成员变量m_ctrlSpin。(Spin只有Control类别的变量)</p>
<blockquote>
<p>SetRange() 改变取值范围</p>
<p>SetPos()设置当前取值 GetPos</p>
</blockquote>
<p>在CTestDialog的OnInitDialog中：<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m_ctrlSpin.SetRange(<span class="number">0</span>,<span class="number">50</span>);</div><div class="line">m_ctrlSpin.SetPos(<span class="number">25</span>);</div></pre></td></tr></table></figure></p>
<p>当按动Spin的按钮时，EditBox中的值会一个一个地变化。</p>
<h3 id="6-滑动条控件-Slider"><a href="#6-滑动条控件-Slider" class="headerlink" title="6.滑动条控件(Slider)"></a>6.滑动条控件(Slider)</h3><p>Slider又称游标控件，通常用于刻度显示与选择。</p>
<ol>
<li>选中Auto Ticks和Tick Marks</li>
<li>Orientation属性设置为Horizontal</li>
<li>Point属性设置为Both</li>
</ol>
<blockquote>
<p>Auto Ticks：指定滑块在其取值范围内对于每一个增量都有一个刻度线</p>
<p>Tick Marks：指定滑块显示刻度线</p>
<p>Orientation：Horizontal-水平；Vertical-垂直</p>
<p>Point：Both-两端；Top/Left-顶/左；Bottom/Right-底/右</p>
</blockquote>
<p>CSliderCtrl用于管理Slider控件，添加成员变量m_ctrlSlider。</p>
<blockquote>
<p>SetRange 改变取值范围</p>
<p>SetTicFreq 改变取值幅度</p>
</blockquote>
<p> 在CTestDialog的OnInitDialog中：<br> <figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m_ctrlSlider.SetRange(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">m_ctrlSlider.SetTicFreq(<span class="number">10</span>);</div></pre></td></tr></table></figure></p>
<h3 id="7-进展条控件-Progress"><a href="#7-进展条控件-Progress" class="headerlink" title="7.进展条控件(Progress)"></a>7.进展条控件(Progress)</h3><p>Progress常用于显示应用程序的执行进展，属性有Border、Vertical、Smooth</p>
<p>CProgressCtrl类用于管理Progress控件，添加成员变量m_ctrlProgress。</p>
<blockquote>
<p>SetRange 改变取值范围</p>
<p>SetStep 改编取值幅度</p>
</blockquote>
<ol>
<li>在CTestDialog的OnInitDialog中：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m_ctrlProgress.SetRange(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">m_ctrlProgress.SetStep(<span class="number">5</span>);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的OnTest中：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</div><div class="line">    m_ctrlProgress.StepIt();</div><div class="line">    Sleep(<span class="number">100</span>);</div><div class="line">  &#125;</div><div class="line"><span class="keyword">if</span>(m_ctrlProgress.GetPos()==<span class="number">100</span>)MessageBox(<span class="string">L"Progress to 100!"</span>);</div></pre></td></tr></table></figure>
<p><strong>可以将滑动条控件与进展条控件联系起来</strong>，当滑动条控件移动时，发送WM_VSCROLL或WM_HSCROLL给父窗口。</p>
<ol>
<li>在CTestDialog的OnInitDialog中：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m_ctrlSlider.SetRange(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">m_ctrlSlider.SetTicFreq(<span class="number">10</span>);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的OnHScroll中：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">m_ctrlProgress.SetPos(m_ctrlSlider.GetPos());</div></pre></td></tr></table></figure>
<h3 id="8-动画控件-Animate"><a href="#8-动画控件-Animate" class="headerlink" title="8.动画控件(Animate)"></a>8.动画控件(Animate)</h3><p>动画控件用于播放无声的.avi文件，属性有Auto Play、Center、Border</p>
<p>CAnimateCtrl类用于管理Animate控件</p>
<hr>
<p>做一个播放动画的对话框：</p>
<ol>
<li>在资源视图中添加一个对话框，并向上面添加一个动画控件，四个按钮。分别为：IDC_ANIMATE、IDC_OPEN、IDC_PLAY、IDC_STOP、IDC_DISPLAY。</li>
<li><p>对四个按钮进行消息处理：</p>
<ol>
<li><p>在CTestDialog的OnOpen中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CFileDialog dlg(true,NULL,NULL,OFN_READONLY,L&quot;Animation(*.avi)|*.avi&quot;);//true:以打开文件的方式打开</div><div class="line">if(dlg.DoModal()==IDOK)&#123;</div><div class="line">    CString filename=dlg.GetPathName();//获得被打开的文件名</div><div class="line">    m_ctrlAnimate.Stop();//停止播放当前打开的动画</div><div class="line">    m_ctrlAnimate.Close();//关闭当前打开的动画</div><div class="line">    m_ctrlAnimate.Open(filename);//打开新动画</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>在CTestDialog的OnPlay中<br><code>m_ctrlAnimate.Play(0,11,1);//从0秒播放到11秒，播放1次</code></p>
</li>
<li>在CTestDialog的OnStop中<br><code>m_ctrlAnimate.Stop();//停止播放</code></li>
<li>在CTestDialog的OnDisplay中<br><code>m_ctrlAnimate.Seek(5);//显示第5秒的静态图片</code></li>
</ol>
</li>
</ol>
<hr>
<h3 id="9-树状控件"><a href="#9-树状控件" class="headerlink" title="9.树状控件"></a>9.树状控件</h3><p>树状控件据说不考。先不写了，到时候印出来。</p>
<h2 id="五、直接创建控件"><a href="#五、直接创建控件" class="headerlink" title="五、直接创建控件"></a>五、直接创建控件</h2><h3 id="1-滑动条控件与进展条控件（单文档应用程序"><a href="#1-滑动条控件与进展条控件（单文档应用程序" class="headerlink" title="1.滑动条控件与进展条控件（单文档应用程序"></a>1.滑动条控件与进展条控件（单文档应用程序</h3><ol>
<li>在CTestView的.h文件中：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span>:</div><div class="line">    CSliderCtrl m_ctrlSlider;</div><div class="line">    CProgress m_ctrlProgress;</div></pre></td></tr></table></figure>
<ol>
<li>在CTestView的.h文件的<code>#program once;</code>之后：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IDC_SLIDER 101;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IDC_PROGRESS 102;</span></div></pre></td></tr></table></figure>
<p>3.在CTestView的.h文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">protected:</div><div class="line">    DECLARE_MESSAGE_MAP();</div><div class="line">public:</div><div class="line">    afx_msg int OnCreate(LPCREATESTRUCT lpCreateStruct);</div><div class="line">	afx_msg void OnHScroll(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar);</div><div class="line">	afx_msg void OnLButtonDown(UINT nFlags, CPoint point);</div><div class="line">//声明函数，如果使用类向导，类向导会做这些。但是话说回来，既然不用资源视图，就纯代码吧</div></pre></td></tr></table></figure>
<ol>
<li>在CTestView的.cpp文件的BEGIN_MESSAGE_MAP(—-)之后：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ON_WM_CREATE()</div><div class="line">ON_WM_HSCROLL()</div><div class="line">ON_WM_LBUTTONDOWN()</div><div class="line">//在END_MESSAGE_MAP之前</div><div class="line">//WM表示这是个消息，如果是命令，则是ON_COMMAND</div></pre></td></tr></table></figure>
<ol>
<li>在CTestView的OnCreate中：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">m_ctrlSlider.Create(WS_CHILD|WS_VISIBLE|WS_BORDER|TBS_AUTOYICKS|TBS_BOTH|TBS_HORZ,CRect(<span class="number">40</span>,<span class="number">40</span>,<span class="number">300</span>,<span class="number">80</span>),<span class="keyword">this</span>,IDC_SLIDER);</div><div class="line">m_ctrlSlider.SetRange(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">m_ctrlSlider.SetTicFreq(<span class="number">10</span>);</div><div class="line"></div><div class="line">m_ctrlProgress.Create(WS_CHILD|WS_VISIBLE|WS_BORDER,CRect(<span class="number">400</span>,<span class="number">40</span>,<span class="number">700</span>,<span class="number">80</span>),<span class="keyword">this</span>,IDC_PROGRESS);</div><div class="line">m_ctrlProgress.SetRange(<span class="number">0</span>,<span class="number">100</span>);</div><div class="line">m_ctrlProgress.SetStep(<span class="number">10</span>);</div><div class="line">m_ctrlProgress.SetPos(<span class="number">50</span>);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestView的OnHScroll中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">CSliderCtrl*pSlider=(CSliderCtrl*)pScrollBar;</div><div class="line">m_str.Format(L&quot;%d&quot;,pSlider-&gt;GetPos());</div><div class="line">Invalidate(true);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestView的OnDraw中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pDC-&gt;TextOutW(40,20,m_str);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestView的OnLButtonDown中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">for(int i=0;i&lt;5;i++)&#123;</div><div class="line">    m_ctrlProgress.StepIt();</div><div class="line">    Sleep(100);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-图像列表与位图-Image-List"><a href="#2-图像列表与位图-Image-List" class="headerlink" title="2.图像列表与位图(Image List)"></a>2.图像列表与位图(Image List)</h3><p>图像列表类似于位图数组，每个位图都有一个索引，用于查找特定的图像。CImageList用于创建、显示和管理图像列表。</p>
<p>例：</p>
<ol>
<li>从资源视图中加载位图：IDB_CLASS , IDB_STUREC , IDB_COMPUTERDEPT , IDB_SELECTEDCLASS , IDB_SELECTEDSTUREC</li>
<li>在CTestDialog的.h文件中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private:</div><div class="line">   CImageList*m_pImageList;</div><div class="line">   void AddBitmapToImageList(int num);</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的构造函数中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">p_ImageList=new CImageList();</div><div class="line">m_pImageList-&gt;Create(16,16,true,0,0);</div><div class="line">AddBitmapToImageList(IDB_COMPUTERDEPT);</div><div class="line">.</div><div class="line">.</div><div class="line">.//这是其他的要被Add的Bitmap</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的AddBitmapToImageList中</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CBitmap bmp;</div><div class="line">bmp.LoadBitmap(num);//要加载的位图数目</div><div class="line">m_pImageList-&gt;Add(&amp;bmp,RGB(255,255,255));</div><div class="line">bmp.DeleteObject();</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialg的OnDestory中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delete m_pImageList;</div></pre></td></tr></table></figure>
<ol>
<li>在CTestDialog的OnPaint的else中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CPaintDC dc(this);</div><div class="line">CPoint pt1(10,10),pt2(10,60);</div><div class="line">int count=m_ImageList-&gt;GetImageCount();</div><div class="line">for(int i=0;i&lt;count;i++)&#123;</div><div class="line">    m_pImageList-&gt;Draw(&amp;dc,i,pt1,ILD_NORMAL);</div><div class="line">    m_pImageList-&gt;Draw(&amp;dc,i,pt2,ILD_MASK);</div><div class="line">    pt1.x+=50;pt2.x+=50;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    傻瓜日和
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://yoursite.com/2018/05/26/MFC基础/MFC：对话框（5/" title="对话框（5">http://yoursite.com/2018/05/26/MFC基础/MFC：对话框（5/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MFC/" rel="tag"># MFC</a>
          
            <a href="/tags/可视化/" rel="tag"># 可视化</a>
          
        </div>
      
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------结束啦 <i class="fa fa-paw"></i> 留下你的爪印叭~-------------</div>
    
</div>
  
</div>

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/23/LINUX基础/Vim命令/" rel="next" title="Vim命令">
                <i class="fa fa-chevron-left"></i> Vim命令
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/29/MATLAB/matlab复习/" rel="prev" title="matlab notes">
                matlab notes <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="傻瓜日和" />
            
              <p class="site-author-name" itemprop="name">傻瓜日和</p>
              <p class="site-description motion-element" itemprop="description">来如春梦不多时 去似朝云无觅处</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">58</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/yayi2456" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yourname@gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://stackoverflow.com/yourname" target="_blank" title="StackOverflow">
                    
                      <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/2723381840/" target="_blank" title="Weibo">
                    
                      <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、对话框的基本概念"><span class="nav-number">1.</span> <span class="nav-text">一、对话框的基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、一个简单的静态与编辑控件对话框"><span class="nav-number">2.</span> <span class="nav-text">二、一个简单的静态与编辑控件对话框</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、通用对话框"><span class="nav-number">3.</span> <span class="nav-text">三、通用对话框</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-CFontDialog-字体对话框"><span class="nav-number">3.1.</span> <span class="nav-text">1.CFontDialog 字体对话框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-CColorDialog-颜色对话框"><span class="nav-number">3.2.</span> <span class="nav-text">2.CColorDialog 颜色对话框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CFileDialog-文件对话框"><span class="nav-number">3.3.</span> <span class="nav-text">3.CFileDialog 文件对话框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-CPrintDialog-打印对话框"><span class="nav-number">3.4.</span> <span class="nav-text">4.CPrintDialog 打印对话框</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-CFindRepalceDialog-寻找与替换对话框"><span class="nav-number">3.5.</span> <span class="nav-text">5.CFindRepalceDialog 寻找与替换对话框</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、控件"><span class="nav-number">4.</span> <span class="nav-text">四、控件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-静态控件"><span class="nav-number">4.1.</span> <span class="nav-text">1.静态控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-按钮控件"><span class="nav-number">4.2.</span> <span class="nav-text">2.按钮控件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-修改位图按钮-文字按扭"><span class="nav-number">4.2.1.</span> <span class="nav-text">1.修改位图按钮/文字按扭</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-为按钮控件添加成员变量"><span class="nav-number">4.2.2.</span> <span class="nav-text">2.为按钮控件添加成员变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-增加一个复选框控件"><span class="nav-number">4.2.3.</span> <span class="nav-text">3.增加一个复选框控件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-组合框控件"><span class="nav-number">4.3.</span> <span class="nav-text">3.组合框控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-列表框控件"><span class="nav-number">4.4.</span> <span class="nav-text">4.列表框控件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#番外：绘图程序的例子"><span class="nav-number">4.5.</span> <span class="nav-text">番外：绘图程序的例子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-旋转框控件-Spin"><span class="nav-number">4.6.</span> <span class="nav-text">5.旋转框控件(Spin)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-滑动条控件-Slider"><span class="nav-number">4.7.</span> <span class="nav-text">6.滑动条控件(Slider)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-进展条控件-Progress"><span class="nav-number">4.8.</span> <span class="nav-text">7.进展条控件(Progress)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-动画控件-Animate"><span class="nav-number">4.9.</span> <span class="nav-text">8.动画控件(Animate)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-树状控件"><span class="nav-number">4.10.</span> <span class="nav-text">9.树状控件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、直接创建控件"><span class="nav-number">5.</span> <span class="nav-text">五、直接创建控件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-滑动条控件与进展条控件（单文档应用程序"><span class="nav-number">5.1.</span> <span class="nav-text">1.滑动条控件与进展条控件（单文档应用程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-图像列表与位图-Image-List"><span class="nav-number">5.2.</span> <span class="nav-text">2.图像列表与位图(Image List)</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">傻瓜日和</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>





  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>


	<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共126.3k字</span>
</div>



        




  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=64002140";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  
  
<div id="hexo-helper-live2d">
  <canvas id="live2dcanvas" width="150" height="300"></canvas>
</div>
<style>
  #live2dcanvas{
    position: fixed;
    width: 150px;
    height: 300px;
    opacity:0.7;
    right: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: -20px;
  }
</style>
<script type="text/javascript" src="/live2d/device.min.js"></script>
<script type="text/javascript">
const loadScript = function loadScript(c,b){var a=document.createElement("script");a.type="text/javascript";"undefined"!=typeof b&&(a.readyState?a.onreadystatechange=function(){if("loaded"==a.readyState||"complete"==a.readyState)a.onreadystatechange=null,b()}:a.onload=function(){b()});a.src=c;document.body.appendChild(a)};
(function(){
  if((typeof(device) != 'undefined') && (device.mobile())){
    document.getElementById("live2dcanvas").style.width = '75px';
    document.getElementById("live2dcanvas").style.height = '150px';
  }else
    if (typeof(device) === 'undefined') console.error('Cannot find current-device script.');
  loadScript("/live2d/script.js", function(){loadlive2d("live2dcanvas", "/live2d/assets/hijiki.model.json", 0.5);});
})();
</script>

</body>
</html>
